{"version":3,"file":"form.min.js","sources":["../src/form.js"],"sourcesContent":["import ModalFactory from 'core/modal_factory';\nimport ModalForm from 'core_form/modalform';\nimport * as Str from 'core/str';\n\nlet modalForm = null;\nlet responseModal = null;\nlet contextid = null;\nlet appendurl = false;\n\n/**\n * Display the form modal and load the form.\n *\n * @param {Event} e\n */\nasync function showForm(e) {\n    e.preventDefault();\n    M.util.js_pending('block_messageteacher_show');\n\n    const link = e.currentTarget;\n    modalForm = new ModalForm({\n        formClass: 'block_messageteacher\\\\message_form',\n        args: {\n            contextid: contextid,\n            appendurl: appendurl,\n            referurl: link.dataset.referurl,\n            courseid: link.dataset.courseid,\n            recipientid: link.dataset.recipientid\n        },\n        modalConfig: {\n            title: await Str.get_string('pluginname', 'block_messageteacher')\n        },\n        saveButtonText: await Str.get_string('send', 'block_messageteacher'),\n        returnFocus: link\n    });\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, submitForm);\n    await modalForm.show();\n    M.util.js_complete('block_messageteacher_show');\n}\n\n/**\n * Send the message entered into the form using a core webservice.\n *\n * @param {Event} e\n */\nasync function submitForm(e) {\n    M.util.js_pending('block_messageteacher_send');\n    if (e.detail < 1) {\n        responseModal.setBody(e.errormessage);\n    } else {\n        const sent = await Str.get_string('messagesent', 'block_messageteacher');\n        responseModal.setBody(sent);\n    }\n    responseModal.show();\n    M.util.js_complete('block_messageteacher_send');\n}\n\n/**\n * Create modals.\n *\n * Create a Save/Cancel modal to display the form, and a Cancel modal for confirmation/error messages.\n */\nexport const init = async function() {\n\n    const title = await Str.get_string('pluginname', 'block_messageteacher');\n\n    responseModal = await ModalFactory.create({\n        type: ModalFactory.types.DEFAULT,\n        title: title\n    });\n\n    var links = document.querySelectorAll('.messageteacher_link');\n    for (var i = 0; i < links.length; i++) {\n        if (contextid === null) {\n            contextid = links[i].parentElement.parentElement.dataset.contextid;\n            appendurl = links[i].parentElement.parentElement.dataset.appendurl;\n        }\n        links[i].addEventListener('click', showForm);\n    }\n};\n"],"names":["modalForm","responseModal","contextid","appendurl","showForm","e","preventDefault","M","util","js_pending","link","currentTarget","ModalForm","formClass","args","referurl","dataset","courseid","recipientid","modalConfig","title","Str","get_string","saveButtonText","returnFocus","addEventListener","events","FORM_SUBMITTED","submitForm","show","js_complete","detail","setBody","errormessage","sent","async","ModalFactory","create","type","types","DEFAULT","links","document","querySelectorAll","i","length","parentElement"],"mappings":"u0CAIIA,UAAY,KACZC,cAAgB,KAChBC,UAAY,KACZC,WAAY,iBAODC,SAASC,GACpBA,EAAEC,iBACFC,EAAEC,KAAKC,WAAW,mCAEZC,KAAOL,EAAEM,cACfX,UAAY,IAAIY,mBAAU,CACtBC,UAAW,qCACXC,KAAM,CACFZ,UAAWA,UACXC,UAAWA,UACXY,SAAUL,KAAKM,QAAQD,SACvBE,SAAUP,KAAKM,QAAQC,SACvBC,YAAaR,KAAKM,QAAQE,aAE9BC,YAAa,CACTC,YAAaC,IAAIC,WAAW,aAAc,yBAE9CC,qBAAsBF,IAAIC,WAAW,OAAQ,wBAC7CE,YAAad,OAEjBV,UAAUyB,iBAAiBzB,UAAU0B,OAAOC,eAAgBC,kBACtD5B,UAAU6B,OAChBtB,EAAEC,KAAKsB,YAAY,4CAQRF,WAAWvB,MACtBE,EAAEC,KAAKC,WAAW,6BACdJ,EAAE0B,OAAS,EACX9B,cAAc+B,QAAQ3B,EAAE4B,kBACrB,OACGC,WAAab,IAAIC,WAAW,cAAe,wBACjDrB,cAAc+B,QAAQE,MAE1BjC,cAAc4B,OACdtB,EAAEC,KAAKsB,YAAY,2CAQHK,uBAEVf,YAAcC,IAAIC,WAAW,aAAc,wBAEjDrB,oBAAsBmC,uBAAaC,OAAO,CACtCC,KAAMF,uBAAaG,MAAMC,QACzBpB,MAAOA,gBAGPqB,MAAQC,SAASC,iBAAiB,wBAC7BC,EAAI,EAAGA,EAAIH,MAAMI,OAAQD,IACZ,OAAd1C,YACAA,UAAYuC,MAAMG,GAAGE,cAAcA,cAAc9B,QAAQd,UACzDC,UAAYsC,MAAMG,GAAGE,cAAcA,cAAc9B,QAAQb,WAE7DsC,MAAMG,GAAGnB,iBAAiB,QAASrB"}